<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Custom 3D Model AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            /* Safe area padding for iPhone X notch */
            padding: env(safe-area-inset-top) env(safe-area-inset-right) 
                     env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .arjs-loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            transition: opacity 0.5s ease;
            /* Adjust for notch */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .loader-spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #2196f3;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .arjs-loader h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #64b5f6;
            text-align: center;
            padding: 0 20px;
        }
        
        .arjs-loader p {
            font-size: 1.1rem;
            max-width: 500px;
            text-align: center;
            line-height: 1.6;
            color: #e0e0e0;
            padding: 0 20px;
        }
        
        a-scene {
            width: 100%;
            height: 100%;
            /* Ensure it fills the entire viewport */
            position: fixed;
            top: 0;
            left: 0;
        }
        
        .minimal-tip {
            position: absolute;
            bottom: calc(20px + env(safe-area-inset-bottom));
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            z-index: 10;
            pointer-events: none;
            padding: 0 20px;
            /* Add background for better readability */
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 15px;
            max-width: 90%;
            margin: 0 auto;
            transition: opacity 0.3s ease;
        }
        
        /* Scale slider container */
        .scale-control {
            position: absolute;
            bottom: 100px;
            left: 0;
            width: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .scale-control.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .scale-slider-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 15px 20px;
            width: 80%;
            max-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .scale-label {
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .scale-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #4a4a4a;
            outline: none;
        }
        
        .scale-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #2196f3;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .scale-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #2196f3;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .scale-value {
            color: white;
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* iPhone XR specific adjustments */
        @media only screen 
          and (device-width: 414px) 
          and (device-height: 896px) 
          and (-webkit-device-pixel-ratio: 2) {
            .arjs-loader h2 {
                font-size: 1.6rem;
            }
            
            .arjs-loader p {
                font-size: 1rem;
            }
            
            .minimal-tip {
                font-size: 15px;
                bottom: calc(30px + env(safe-area-inset-bottom));
            }
            
            .scale-control {
                bottom: 120px;
            }
        }
        
        /* General mobile adjustments */
        @media (max-width: 768px) {
            .minimal-tip {
                font-size: 14px;
                bottom: calc(15px + env(safe-area-inset-bottom));
            }
            
            .arjs-loader h2 {
                font-size: 1.5rem;
            }
            
            .arjs-loader p {
                font-size: 0.95rem;
            }
            
            .scale-control {
                bottom: 90px;
            }
        }
        
        /* Small screen adjustments */
        @media (max-height: 700px) {
            .scale-control {
                bottom: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="arjs-loader">
        <div class="loader-spinner"></div>
        <h2>Loading Custom 3D Model AR</h2>
        <p>Point your camera at the Hiro marker when loaded</p>
    </div>
    
    <div class="minimal-tip">Point camera at Hiro marker to see your 3D model</div>
    
    <!-- Scale slider container -->
    <div class="scale-control" id="scaleControl">
        <div class="scale-slider-container">
            <div class="scale-label">Adjust Model Size</div>
            <input type="range" min="0.1" max="2" step="0.05" value="0.3" class="scale-slider" id="scaleSlider">
            <div class="scale-value">Size: <span id="scaleValue">0.3</span></div>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="antialias: true; alpha: true;"
    >
        <a-assets>
            <!-- 
            ====================================================================
            ADD YOUR CUSTOM 3D MODEL HERE
            Replace the example URL with your GitHub Pages model URL
            Supported formats: .gltf, .glb, .obj, .mtl, etc.
            
            Example for GitHub Pages:
            <a-asset-item id="my-model" src="https://yourusername.github.io/your-repository/models/your-model.gltf"></a-asset-item>
            
            If using OBJ/MTL:
            <a-asset-item id="my-model-obj" src="https://yourusername.github.io/your-repository/models/your-model.obj"></a-asset-item>
            <a-asset-item id="my-model-mtl" src="https://yourusername.github.io/your-repository/models/your-model.mtl"></a-asset-item>
            ====================================================================
            -->
            <a-asset-item id="custom-model" src="https://raw.githubusercontent.com/ali-ahmed1001/Atom-AR/refs/heads/main/Sculpture_LongHat.glb"></a-asset-item>
        </a-assets>

        <!-- Hiro marker with helpers disabled -->
        <a-marker 
            type="pattern" 
            preset="hiro"
            markerhelpers="disableAxis: true; disablePattern: true"
            axis="false"
            debug="false"
        >
            <!-- 
            ====================================================================
            REPLACE THE ATOM MODEL WITH YOUR CUSTOM 3D MODEL HERE
            
            Remove or comment out the atom model components below and add your model.
            Adjust position, scale, and rotation as needed for your model.
            
            For GLTF/GLB models use:
            <a-entity gltf-model="#custom-model" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 0 0"></a-entity>
            
            For OBJ/MTL models use:
            <a-entity obj-model="obj: #my-model-obj; mtl: #my-model-mtl" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 0 0"></a-entity>
            
            Example with current demo model (replace with your model):
            ====================================================================
            -->
            <a-entity 
                id="model-entity"
                gltf-model="#custom-model" 
                position="0 0.5 0" 
                scale="0.3 0.3 0.3" 
                rotation="0 45 0"
                animation="property: rotation; to: 0 405 0; loop: true; dur: 8000; easing: linear"
            ></a-entity>

            <!-- 
            ====================================================================
            ORIGINAL ATOM MODEL - COMMENTED OUT
            Remove the comment tags if you want to keep the atom as background
            or remove completely to only show your custom model
            
            <!-- Nucleus -->
            <!-- <a-entity mixin="nucleus" position="0 0 0"></a-entity> -->

            <!-- Orbital path - thin ring -->
            <!-- <a-torus 
                id="orbit-ring"
                mixin="orbit-path"
                radius="1"
                radius-tubular="0.003"
                rotation="-90 0 0"
                position="0 0 0"
            ></a-torus> -->

            <!-- Electron orbiting the nucleus -->
            <!-- <a-entity 
                id="electron-orbiter" 
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"
            >
                <a-entity 
                    id="electron-entity" 
                    mixin="electron" 
                    position="1 0 0"
                    animation="property: scale; dir: alternate; dur: 1000; loop: true; to: 1.5 1.5 1.5; easing: easeInOutQuad"
                ></a-entity>
            </a-entity> -->
            ====================================================================
            -->
        </a-marker>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
        
        <!-- Ambient light -->
        <a-entity light="type: ambient; color: #aaa; intensity: 0.8"></a-entity>
        
        <!-- Directional light -->
        <a-entity light="type: directional; color: #ffffff; intensity: 0.8" position="-1 1 1"></a-entity>
    </a-scene>

    <script>
        // Get DOM elements
        const scene = document.querySelector('a-scene');
        const scaleSlider = document.getElementById('scaleSlider');
        const scaleValue = document.getElementById('scaleValue');
        const scaleControl = document.getElementById('scaleControl');
        const tipElement = document.querySelector('.minimal-tip');
        
        // Hide loader when scene is loaded
        scene.addEventListener('loaded', () => {
            document.querySelector('.arjs-loader').style.opacity = 0;
            setTimeout(() => {
                document.querySelector('.arjs-loader').style.display = 'none';
            }, 500);
        });
        
        // Hide tip and show scale slider when marker is found
        scene.addEventListener('markerFound', () => {
            tipElement.style.opacity = 0;
            scaleControl.classList.add('active');
        });
        
        // Show tip and hide scale slider when marker is lost
        scene.addEventListener('markerLost', () => {
            tipElement.style.opacity = 1;
            scaleControl.classList.remove('active');
        });
        
        // Update model scale when slider value changes
        scaleSlider.addEventListener('input', function() {
            const scale = this.value;
            const modelEntity = document.getElementById('model-entity');
            
            if (modelEntity) {
                // Apply the same scale to all axes to maintain proportions
                modelEntity.setAttribute('scale', `${scale} ${scale} ${scale}`);
                scaleValue.textContent = scale;
            }
        });
        
        // iOS-specific fixes
        if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
            // Force user interaction to enable audio/video
            document.body.addEventListener('touchstart', function() {
                // This empty handler enables audio/video on iOS
            }, { once: true });
            
            // Handle iOS orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                }, 500);
            });
        }
    </script>
</body>
</html>
